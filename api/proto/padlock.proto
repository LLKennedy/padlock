syntax = "proto3";

package padlock;

option go_package = "github.com/LLKennedy/padlock/padlockpb";

import "tsjson.proto";
option (tsjson.npm_package) = "@llkdemo/padlock";
option (tsjson.import_path) = "padlock";

import "pkcs11.proto";

service Padlock {
	// Auth RPCs

	// PostHello initiates a session with the application, generating an authentication token
	rpc PostHello(AuthHello) returns (AuthToken);

	// Application RPCs

	// PostApplicationListModules lists modules already connected to the application
	rpc PostApplicationListModules(ApplicationListModulesRequest) returns (ApplicationListModulesResponse);
	// PostApplicationConnect connects a new module to the application
	rpc PostApplicationConnect(ApplicationConnectRequest) returns (stream ApplicationConnectUpdate);

	// Module RPCs

	// PostModuleListSlots
	rpc PostModuleListSlots(ModuleListSlotsRequest) returns (ModuleListSlotsResponse);
}

message AuthHello {

}

message AuthToken {
	bytes data = 1;
}

message ApplicationListModulesRequest {
	AuthToken auth = 1;
}

message ApplicationListModulesResponse {
	repeated string modules = 1;
}

message ApplicationConnectRequest {
	AuthToken auth = 1;
	string module = 2;
}

message ApplicationConnectUpdate {
	oneof update {
		bool logged_in = 1;
	}
}

message ModuleListSlotsRequest {
	AuthToken auth = 1;
}

message ModuleListSlotsResponse {
	repeated Slot slots = 1;
}